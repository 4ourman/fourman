<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/basic.html}">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <th:block layout:fragment="headerFragment">
        <link th:href="@{/css/styles.css}" rel="stylesheet" />
    </th:block>
</head>
<th:block layout:fragment="content">
    <body>
    <div class="postcontent" style="margin:40px 80px;">
        <table style="border-bottom:1px solid; width: 1340px;">
            <tbody>
            <h5 style="color:#35a845;">양주 게시판</h5>
            <tr>
                <td style="font-weight:800; font-size:45px;" colspan="3" th:text="${post.ptitle}">제목</td>
            </tr>
            <tr style="text-align: left;">
                <th scope="row">작성자</th>
                <td th:text="${post.unickname}"></td>
                <th style="font-weight:100;" scope="row">조회</th>
                <td>조회수</td><!-- 조회수는 여기에 표시 -->
            </tr>
            </tbody>
        </table>
        <table class="postcontent2">
            <tbody>
            <tr>
                <td colspan="4" class="view_text" th:text="${post.p_content}">
                </td>
            </tr>
            </tbody>
        </table>
        <div>
            <a th:href="@{'/api/v1/posts/update/' + ${post.postId}}" class="btn btn-secondary">수정</a>
            <button onclick="confirmDelete()">삭제</button>
        </div>
        <div>
            <div class="comments mt-3">
            </div>
            <form class="postcomment" onsubmit="addComment(event)">
                <div class="form-group">
                    <input type="text" class="form-control2" placeholder="댓글을 입력하세요" required>
                </div>
                <button type="submit" class="btn btn-primary">작성</button>
            </form>
        </div>
    </div>
    </body>
    <script src="/js/script.js"></script>
    <script>
        function confirmDelete() {
            // 현재 URL에서 postId 추출
            var postId = window.location.pathname.split('/').pop();
            console.log('현재 URL의 postId:', postId);

            if (!postId) {
                console.error('postId가 올바르게 전달되지 않았습니다.');
                return;
            }

            if (confirm('정말로 삭제하시겠습니까?')) {
                deletePost(postId);
            }
        }

        function deletePost(postId) {
            fetch('/api/v1/posts/post/' + postId, {
                method: 'DELETE'
            })
                .then(response => {
                    if (response.ok) {
                        // 성공적으로 삭제된 경우
                        console.log('게시물이 성공적으로 삭제되었습니다.');
                        // 메인 페이지로 이동
                        window.location.href = '/api/v1/posts/main';
                    } else {
                        // 삭제 실패한 경우
                        console.error('게시물 삭제에 실패했습니다.');
                    }
                })
                .catch(error => {
                    console.error('네트워크 오류:', error);
                });
        }
    </script>

</th:block>
</html>